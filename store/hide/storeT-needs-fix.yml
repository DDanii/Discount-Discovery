#await fetch("https://api.prod.retail.tesco.com/marketing/leaflets-be/graphql", {
#     "credentials": "omit",
#     "headers": {
#         "User-Agent": "Mozilla/5.0 (X11; Linux x86_64; rv:144.0) Gecko/20100101 Firefox/144.0",
#         "Accept": "*/*",
#         "Accept-Language": "en-US,en;q=0.5",
#         "content-type": "application/json",
#         "traceparent": "00-33473779f08581a280d83ee5454f5cb8-ba7022d3588c05af-01",
#         "Sec-Fetch-Dest": "empty",
#         "Sec-Fetch-Mode": "cors",
#         "Sec-Fetch-Site": "cross-site",
#         "Priority": "u=4",
#         "Pragma": "no-cache",
#         "Cache-Control": "no-cache"
#     },
#     "referrer": "https://www.tesco.hu/",
#     "body": "{\"operationName\":\"promotions\",\"variables\":{\"country\":\"hu\",\"today\":\"2025-11-12T19:39:00.000Z\",\"skip\":12,\"take\":12,\"sort\":{\"name\":\"ASC\"},\"saving\":{\"min\":0,\"max\":100},\"flags\":{},\"storeType\":null,\"categoryId\":null},\"query\":\"query promotions($country: CountryCode!, $today: DateTime!, $categoryId: Int, $storeId: String, $saving: SavingRange, $flags: PromoFlags, $sort: PromotionPeriodSortParameters, $take: Int, $skip: Int, $storeType: EStoreType) {\\n  promotions(\\n    options: {country: $country, today: $today, storeId: $storeId, saving: $saving, flags: $flags, sort: $sort, skip: $skip, take: $take, storeType: $storeType, categoryId: $categoryId}\\n  ) {\\n    items {\\n      id\\n      promoOfferName\\n      promoName\\n      periodName\\n      isOverriddenPromoName\\n      country\\n      displayedProductName\\n      displayedDescription\\n      normalRetailPrice\\n      normalNewPrice\\n      ccPrice\\n      ccFrom\\n      ccTo\\n      promoStart\\n      promoEnd\\n      visibilityStart\\n      visibilityEnd\\n      saving\\n      rewardValue\\n      pngUrl\\n      promoMechanicsName\\n      isInGhs\\n      addToBasketURL\\n      availableInHm\\n      availableInSm\\n      availableInEx\\n      x\\n      y\\n      multisaveOnePiecePrice\\n      treshold\\n      listIdForEhp\\n      posComm\\n      nationalFlag\\n      showInfoBox\\n      ccMemberPromo\\n      thresholdType\\n      ccSaving\\n      promoOfferNameOverride\\n      linksavePackagePrice\\n      loyaltyRatio\\n      bestSeller\\n      bombDiscounts {\\n        id\\n        index\\n        price\\n        unitPrice\\n        saving\\n        start\\n        end\\n        __typename\\n      }\\n      promotionUnitType {\\n        sid\\n        name\\n        hideCurrency\\n        hideMeasure\\n        __typename\\n      }\\n      __typename\\n    }\\n    totalItems\\n    __typename\\n  }\\n}\"}",
#     "method": "POST",
#     "mode": "cors"
# });


steps:
  - stepParameters:
      method: CreateArray
      name: headers
  - stepParameters: 
      method: Literal
      data: https://tesco.hu
      destination: imageUrlStart
  - stepParameters: 
      method: Literal
      data: "-1"
  - stepParameters: 
      method: SetProp
      destination: empty
      destinationProp: price
  - stepParameters: 
      method: Literal
      data: Mozilla/5.0 (X11; Linux x86_64; rv:133.0) Gecko/20100101 Firefox/133.0
  - stepParameters: 
      method: SetProp
      destination: header1
      destinationProp: User-Agent
  - stepParameters: 
      method: PushToArray
      array: headers
      data: header1
  - stepParameters: 
      method: Literal
      data: gzip, deflate, br, zstd
  - stepParameters: 
      method: SetProp
      destination: header2
      destinationProp: Accept-Encoding
  - stepParameters: 
      method: PushToArray
      array: headers
      data: header2
  - stepParameters: 
      method: Literal
      data: https://tesco.hu/Ajax?apage=1&limit=1000&type=load-more-products&path=/akciok/akcios-termekek/&page_url=undefined
  - stepParameters:
      method: Fetch
      headersSource: headers
  - stepParameters: 
      method: ParseJSON
  - stepParameters: 
      method: SetProp
      sourceProp: products
      destination: products
  - stepParameters: 
      method: ForEach
      source: products
      steps:
        - stepParameters: 
            method: SetProp
            destination: data-save
        - stepParameters: 
            method: SetProp
            sourceProp: id
            destination: product
            destinationProp: id
        - stepParameters: 
            method: SetProp
            sourceProp: name
            destination: product
            destinationProp: name

        - stepParameters: 
            method: SetProp
            sourceProp: data
            destination: pdata
        
        - stepParameters: 
            method: SetProp
            source: pdata
            sourceProp: new-price
            destination: np
        

        - stepParameters: 
            method: SetProp
            sourceProp: data   
        - stepParameters: 
            method: SetProp
            sourceProp: template
        - stepParameters: 
            method: SetProp
            sourceProp: data
        - stepParameters: 
            method: SetProp
            sourceProp: clubcard-price
            destination: cp
        - stepParameters: 
            method: Spread
            first: empty
            second: np
        - stepParameters: 
            method: Spread
            second: cp

        - stepParameters: 
            method: SetProp
            sourceProp: price

        - stepParameters: 
            method: ParseJSON
        - stepParameters: 
            method: SetProp
            destination: product
            destinationProp: price

        - stepParameters: 
            method: SetProp
            source: data-save
        - stepParameters: 
            method: SetProp
            sourceProp: imageurl

        - stepParameters: 
            method: Concat
            first: imageUrlStart
        - stepParameters: 
            method: SetProp
            destination: product
            destinationProp: image


        - stepParameters: 
            method: PushToArray
            array: DDParsedProducts
            data: product