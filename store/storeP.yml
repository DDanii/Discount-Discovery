name: Penny
steps:
  - stepParameters:
      method: CreateArray
      name: urls

  - stepParameters:
      method: Literal
      data: "https://www.penny.hu/api/product-discovery/products/search/*?tab=products&page=0&pageSize=500"
      destination: url

  - stepParameters:
      method: PushToArray
      array: urls
      data: url

  - stepParameters:
      method: Literal
      data: "https://www.penny.hu/api/product-discovery/products/search/*?tab=products&page=1&pageSize=500"
      destination: url

  - stepParameters:
      method: PushToArray
      array: urls
      data: url

  - stepParameters:
      method: Literal
      data: "https://www.penny.hu/api/product-discovery/products/search/*?tab=products&page=2&pageSize=500"
      destination: url

  - stepParameters:
      method: PushToArray
      array: urls
      data: url

  - stepParameters:
      method: ForEach
      source: urls
      steps:
        - stepParameters:
            method: Fetch

        - stepParameters:
            method: ParseJSON

        - stepParameters:
            method: SetProp
            source: data.results
            destination: results

        - stepParameters:
            method: ForEach
            source: results
            steps:
              - stepParameters:
                  method: SetProp
                  source: data.images.0
                  destination: product.image

              - stepParameters:
                  method: SetProp
                  source: data.category
                  destination: product.category

              - stepParameters:
                  method: SetProp
                  source: data.name
                  destination: product.name

              - stepParameters:
                  method: SetProp
                  source: data.sku
                  destination: product.externalId
              - stepParameters: 
                  method: SetProp
                  source: data.price.validityStart
                  destination: product.startDate
              - stepParameters: 
                  method: SetProp
                  source: data.price.validityEnd
                  destination: product.endDate
              - stepParameters:
                  method: SetProp
                  source: data.price.regular.value
              - stepParameters:
                  method: ToString
              - stepParameters:
                  method: Slice
                  start: 0
                  end: -2
              - stepParameters: 
                  method: ParseJSON
              - stepParameters:
                  method: SetProp
                  destination: product.price
              - stepParameters:
                  method: PushToArray
                  array: DDParsedProducts
                  data: product
